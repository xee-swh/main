# Redis

## Redis 支持的数据类型有哪些？有哪些使用场景？
	
	Redis存储包含了5中常用的数据结构
	字符串： 缓存常见的字符串
	哈希：缓存hash对象
	列表：可以用于队列
	集合：set，可以用于朋友圈相互好友等
	有序集合：排行榜


## 什么是缓存穿透？怎么解决？

	缓存穿透是指缓存不存在，数据库不存在，此时有大量的请求都访问这个热点key,就会直接访问数据库，造成数据库压力增大，甚至宕机的可能

	解决办法：
		1、对空值进行缓存
		2、使用布隆过滤器
		3、接口校验

## 什么是缓存击穿？怎么解决？
	
	redis中的某个热点key过期，但是此时有大量的用户访问该过期key

	解决方案：

	1、提前对热点数据进行设置 ，类似于新闻、某博等软件都需要对热点数据进行预先设置在redis中
	2、监控数据，适时调整，监控哪些数据是热门数据，实时的调整key的过期时长
	3、使用锁机制，只有一个请求可以获取到互斥锁，然后到DB中将数据查询并返回到Redis，之后所有请求就可以从Redis中得到响应

## 什么是缓存雪崩？怎么解决？

	redis中大量key过期，这时候有大量请求到达，可能导致DB崩溃，

	解决办法：
	1、缓存时间尽量分散
	2、使用锁
	3、使用多级缓存

## Redis 怎么实现分布式锁？
	可以使用setNx，也可以使用Redisson来实现。

## Redis 持久化有几种方式？

	AOF
		采用追加的方式进行
		执行完命令后才记录日志，
		提供三种写回策略  
			always：同步写回，每个子命令执行完，都立即将日志写回磁盘
			evertsec,每个命令执行完，只是先把日志写到AOF内存缓存区，隔一秒同步到磁盘
			no：只是先把日志写到AOF内存缓存区，由操作系统决定合适写入磁盘

		优点：
			数据保证
		缺点：
			性能相对较差
			提交较大
			恢复较慢

	RDB
		就是把内存数据以快照的形式保存到磁盘上。它是Redis默认的持久化方式。执行完操作后，在指定目录下会生成一个dump.rdb文件，
		redis重启的时候，通过加载dump.rdb文件来恢复数据。

		优点：
			体积小
			恢复快
			性能高
		缺点：
			故障丢失
		
## Redis 淘汰策略有哪些？

    LRU/LFU/RANDOM

    volatile-lru：当内存不足执行写入操作时，在设置了过期时间的键空间中，移除最近最少（最长时间）使用的 key。

    allkeys-lru：当内存不足执行写入操作时，在整个键空间中，移除最近最少（最长时间）使用的 key。（这个是最常用的）

    volatile-lfu：当内存不足执行写入操作时，在设置了过期时间的键空间中，移除最不经常（最少次）使用的key。

    allkeys-lfu：当内存不足执行写入操作时，在整个键空间中，移除最不经常（最少次）使用的key。

    volatile-random -> 当内存不足执行写入操作时，在设置了过期时间的键空间中，随机移除某个 key。

    allkeys-random -> 当内存不足执行写入操作时，在整个键空间中，随机移除某个 key。

    volatile-ttl -> 当内存不足执行写入操作时，在设置了过期时间的键空间中，优先移除过期时间最早（剩余存活时间最短）的 key。

    noeviction：不删除任何 key, 只是在内存不足写操作时返回一个错误。（默认选项，一般不会选用）


## redis的过期策略
    分析:比如redis只能存5G数据，可是你写了10G，那会删除5G的数据。怎么删除？这个问题思考过没有？
    还有你的数据已经设置过了过期时间了，但是时间到了，内存占用率还是比较高，有思考过原因? 

    回答: redis可以采用定期删除+惰性删除策略。 为什么不用定时删除策略? 定时删除,用一个定时器来负责监规key,
    过期则自动删除。虽然内存及时释放，但是十分消耗CPU资源。在大并发的请求下， CPU要将时间应用在处理请求，
    而不是删除key,因此没有采用这一策略.定期删除+惰性删除是如何工作的呢? 定期删除， redis默讣每个100ms检查
    是否有过期的key,有过期的key则删除。需要说明的是，redis不是每个100ms将所有的key检查一次，而是随机抽取进行
    检查(如果每个100ms,全部key进行检查， redis岂不是卡死)，因此，如果只采用定期删除策略，会导致很多key到时间
    没有删除。 于是，惰性删除派上用场。也就是说在获取某个key的时候， redis会检查一下，返个key如果设置了过期时
    间，如果过期了此时就会删除，采用定期删除+惰性删除就没其他问题了吗? 并不是，如果定期删除没删除key。然后你也
    没即时去请求key，也就是说惰性删除也没生效。这种情况下redis癿内存会越来越高。
    内存淘汰机制
    那就要采用内存淘汰机制。 在redis.conf中有一行配置
    # maxmemory-policy volatile-lru


1、启动
附带配置文件
redis-server redis.windows.conf


连接客户端指定密码
redis-cli -h 127.0.0.1 -p 6379 -a redis


2常用命令

type key  查看key类型

object encoding key 查看key底层数据结构

help @string 查看该类型使用命令


常用数据结构
链表
字段
跳跃表
压缩列表
